data = [
  {
    "id": "0",
    "text": "所有分类",
    "children": [
      {
        "id": "58e6ee4369c7ef1100ad2f06",
        "text": "饮料",
        "level": 1,
        "parent_id": "",
        "children": [
          {
            "id": "58f0922f0c8ea811005dbaa5",
            "text": "碳酸饮料",
            "level": 2,
            "parent_id": "58e6ee4369c7ef1100ad2f06",
            "children": [
              {
                "BarCode": "6954767430461",
                "Name": "雪碧纤维+500mlPET瓶",
                "CategoryID": "58f0922f0c8ea811005dbaa5",
                "ParentCategoryID": "58e6ee4369c7ef1100ad2f06",
                "ImageUrl": "https://res.yopoint.com/product/20180328/a8c66eeb3bdf6080aa7d28b6ec06b687.png",
                "ImageFixWidthUrl": "https://res.yopoint.com/product/20180328/09c344e99bae1b7c9ac78359f130edbb.png",
                "TotalReplenishStock": 4,
                "TotalSalesCount": 0,
                "AccountStock": 0,
                "BoxGauge": 26,
                "name": "雪碧纤维+500mlPET瓶",
                "stockoutCount": 0,
                "pickupNum": 0
              }
            ]
          },
          {
            "id": "59093995b9128e1100e477cd",
            "text": "茶类饮料",
            "level": 2,
            "parent_id": "58e6ee4369c7ef1100ad2f06",
            "children": [
              {
                "BarCode": "6921168558025",
                "Name": "农夫山泉东方树叶红茶瓶装500ml",
                "CategoryID": "59093995b9128e1100e477cd",
                "ParentCategoryID": "58e6ee4369c7ef1100ad2f06",
                "ImageUrl": "https://res.yopoint.com/product/20170901/98e9148dd69e0df25e38e7f613245a05.png",
                "ImageFixWidthUrl": "https://res.yopoint.com/product/20170901/0c76e9367b432d0362e5d06172458182.png",
                "TotalReplenishStock": 0,
                "TotalSalesCount": 0,
                "AccountStock": 0,
                "BoxGauge": 25,
                "name": "农夫山泉东方树叶红茶瓶装500ml",
                "stockoutCount": 0,
                "pickupNum": 0
              },
              {
                "BarCode": "6901334402666",
                "Name": "王老吉白云山泡泡茶瓶装480ml",
                "CategoryID": "59093995b9128e1100e477cd",
                "ParentCategoryID": "58e6ee4369c7ef1100ad2f06",
                "ImageUrl": "https://res.yopoint.com/product/20190702/5435b4f49bec7107f574ded14386c11c.png",
                "ImageFixWidthUrl": "https://res.yopoint.com/product/20190702/4d20c4de2c1efb09e0f7b3155b4c592a.png",
                "TotalReplenishStock": 2,
                "TotalSalesCount": 1,
                "AccountStock": 0,
                "BoxGauge": 25,
                "name": "王老吉白云山泡泡茶瓶装480ml",
                "stockoutCount": 1,
                "pickupNum": 1
              }
            ]
          }
        ]
      }
    ],
    "level": 0
  }
]

onlyGoods = [
  {
    "BarCode": "6954767430461",
    "Name": "雪碧纤维+500mlPET瓶",
    "CategoryID": "58f0922f0c8ea811005dbaa5",
    "ParentCategoryID": "58e6ee4369c7ef1100ad2f06",
    "ImageUrl": "https://res.yopoint.com/product/20180328/a8c66eeb3bdf6080aa7d28b6ec06b687.png",
    "ImageFixWidthUrl": "https://res.yopoint.com/product/20180328/09c344e99bae1b7c9ac78359f130edbb.png",
    "TotalReplenishStock": 4,
    "TotalSalesCount": 0,
    "AccountStock": 0,
    "BoxGauge": 26,
    "name": "雪碧纤维+500mlPET瓶",
    "stockoutCount": 0,
    "pickupNum": 0
  },
  {
    "BarCode": "6921168558025",
    "Name": "农夫山泉东方树叶红茶瓶装500ml",
    "CategoryID": "59093995b9128e1100e477cd",
    "ParentCategoryID": "58e6ee4369c7ef1100ad2f06",
    "ImageUrl": "https://res.yopoint.com/product/20170901/98e9148dd69e0df25e38e7f613245a05.png",
    "ImageFixWidthUrl": "https://res.yopoint.com/product/20170901/0c76e9367b432d0362e5d06172458182.png",
    "TotalReplenishStock": 0,
    "TotalSalesCount": 0,
    "AccountStock": 0,
    "BoxGauge": 25,
    "name": "农夫山泉东方树叶红茶瓶装500ml",
    "stockoutCount": 0,
    "pickupNum": 0
  },
  {
    "BarCode": "6901334402666",
    "Name": "王老吉白云山泡泡茶瓶装480ml",
    "CategoryID": "59093995b9128e1100e477cd",
    "ParentCategoryID": "58e6ee4369c7ef1100ad2f06",
    "ImageUrl": "https://res.yopoint.com/product/20190702/5435b4f49bec7107f574ded14386c11c.png",
    "ImageFixWidthUrl": "https://res.yopoint.com/product/20190702/4d20c4de2c1efb09e0f7b3155b4c592a.png",
    "TotalReplenishStock": 2,
    "TotalSalesCount": 1,
    "AccountStock": 0,
    "BoxGauge": 25,
    "name": "王老吉白云山泡泡茶瓶装480ml",
    "stockoutCount": 1,
    "pickupNum": 1
  }
]

new1 = {
  "OID": "5db266d87bd4810010954b0e",
  "BarCode": "0202008142139",
  "PayExtend": "",
  "VerifyRules": [],
  "SpecBarCode": true,
  "Price": 0,
  "InnerCode": "",
  "ParentCategoryID": "5993b34ac01923000f0cd13a",
  "CategoryID": "5993b4453c7f730011f30c4f",
  "ProductID": "",
  "ImageUrl": "",
  "ImageFixWidthUrl": "",
  "IsSelfImage": 0,
  "SpecQty": 0,
  "DescImageUrl": [],
  "HorizontalDescImageUrl": [],
  "SpecExtend": {},
  "DynamicSaleRatio": 0,
  "CanSaleDays": 0,
  "SaleCount7Days": 0,
  "DailySaleCount7Days": 0,
  "DepotStock": 0,
  "TerminalStock": 0,
  "ReplenisherStock": 0,
  "TotalStock": 0,
  "LastPurchaseTime": 0,
  "UpdateDynamicTime": 1597946400,
  "CreateAt": 1597373439,
  "UpdatedAt": 1597946400,
  "id": "5f35fbff7d6749000ff454d3",
  "ProductVO": {
    "Name": "自拍帅哥服务",
    "ImageUrl": "http://dev-res.yopoint.cc/operators/20200723/e5c5894d9f4ac7d1f916e0199347820e.jpg",
    "ImageFixWidthUrl": "http://dev-res.yopoint.cc/operators/20200723/e5c5894d9f4ac7d1f916e0199347820e.jpg",
    "ColdStatus": true,
    "HotStatus": true,
    "ColSpan": 1,
    "Status": 0,
    "ProductSuggestion": [],
    "Brand": "",
    "Manufacturer": "",
    "Price": 0,
    "BoxGauges": [],
    "SuggestionCargoListVO": "",
    "BoxGauge": 1
  },
  "CategoryVO": {
    "Name": "自拍",
    "ParentID": "5993b34ac01923000f0cd13a",
    "Level": 2,
    "CreateAt": 1502852165,
    "UpdatedAt": 1502852165,
    "id": "5993b4453c7f730011f30c4f"
  },
  "ParentCategoryVO": {
    "Name": "数码产品",
    "ParentID": "",
    "Level": 1,
    "CreateAt": 1502851914,
    "UpdatedAt": 1502851914,
    "id": "5993b34ac01923000f0cd13a"
  },
  "StockVO": false,
  "AccountStock": 0
}

new2 = {
  "OID": "5db266d87bd4810010954b0e",
  "BarCode": "9311770599290",
  "PayExtend": "",
  "VerifyRules": [],
  "SpecBarCode": false,
  "Price": 0,
  "InnerCode": "",
  "ParentCategoryID": "5c71595549b1a5001351a2f6",
  "CategoryID": "5c715963d3b8950011f866b5",
  "ProductID": "",
  "ImageUrl": "",
  "ImageFixWidthUrl": "",
  "IsSelfImage": 0,
  "SpecQty": 0,
  "DescImageUrl": [],
  "HorizontalDescImageUrl": [],
  "SpecExtend": {},
  "DynamicSaleRatio": 0,
  "CanSaleDays": 0,
  "SaleCount7Days": 0,
  "DailySaleCount7Days": 0,
  "DepotStock": 0,
  "TerminalStock": 0,
  "ReplenisherStock": 0,
  "TotalStock": 0,
  "LastPurchaseTime": 0,
  "UpdateDynamicTime": 0,
  "CreateAt": 1597394992,
  "UpdatedAt": 1597394992,
  "id": "5f3650307d6749000ff45523",
  "ProductVO": {
    "Name": "月见草油",
    "ImageUrl": "http://dev-res.yopoint.cc/resource/20200814/b1ee1d42cceb4748619ee3812b1992c2.jpg",
    "ImageFixWidthUrl": "http://dev-res.yopoint.cc/resource/20200814/4432c402caef3899c329344e77a05354.jpg",
    "ColdStatus": false,
    "HotStatus": false,
    "ColSpan": 1,
    "Status": 1,
    "ProductSuggestion": [],
    "Brand": "",
    "Manufacturer": "",
    "Price": 0,
    "BoxGauges": [],
    "SuggestionCargoListVO": "",
    "BoxGauge": 1
  },
  "CategoryVO": {
    "Name": "未分类",
    "ParentID": "5c71595549b1a5001351a2f6",
    "Level": 2,
    "CreateAt": 1550932323,
    "UpdatedAt": 1550932323,
    "id": "5c715963d3b8950011f866b5"
  },
  "ParentCategoryVO": {
    "Name": "其他",
    "ParentID": "",
    "Level": 1,
    "CreateAt": 1550932309,
    "UpdatedAt": 1550932422,
    "id": "5c71595549b1a5001351a2f6"
  },
  "StockVO": false,
  "AccountStock": 0
}

new3 = {
  "OID": "5db266d87bd4810010954b0e",
  "BarCode": "6901180993486",
  "PayExtend": "",
  "VerifyRules": [],
  "SpecBarCode": false,
  "Price": 0,
  "InnerCode": "",
  "ParentCategoryID": "58f094160f5dbd1100568db3",
  "CategoryID": "59093ab8b9128e1100e477d5",
  "ProductID": "",
  "ImageUrl": "",
  "ImageFixWidthUrl": "",
  "IsSelfImage": 0,
  "SpecQty": 0,
  "DescImageUrl": [],
  "HorizontalDescImageUrl": [],
  "SpecExtend": {},
  "DynamicSaleRatio": 0,
  "CanSaleDays": 99999,
  "SaleCount7Days": 0,
  "DailySaleCount7Days": 0,
  "DepotStock": 46,
  "TerminalStock": 0,
  "ReplenisherStock": 20,
  "TotalStock": 66,
  "LastPurchaseTime": 1595407782,
  "UpdateDynamicTime": 1597946400,
  "CreateAt": 1591684685,
  "UpdatedAt": 1597946400,
  "id": "5edf2e4d1952bc000f696b48",
  "ProductVO": {
    "Name": "嘉士利饼干",
    "ImageUrl": "https://res.yopoint.com/product/20181123/b3b2b7f3729a4a12b562f12be33958c0.png",
    "ImageFixWidthUrl": "https://res.yopoint.com/product/20181123/b3b2b7f3729a4a12b562f12be33958c0.png",
    "ColdStatus": true,
    "HotStatus": false,
    "ColSpan": 1,
    "Status": 1,
    "ProductSuggestion": [],
    "Brand": "嘉士利",
    "Manufacturer": "嘉士利",
    "Price": 0,
    "BoxGauges": [],
    "SuggestionCargoListVO": "",
    "BoxGauge": 66
  },
  "CategoryVO": {
    "Name": "饼干",
    "ParentID": "58f094160f5dbd1100568db3",
    "Level": 2,
    "CreateAt": 1493777080,
    "UpdatedAt": 1493777080,
    "id": "59093ab8b9128e1100e477d5"
  },
  "ParentCategoryVO": {
    "Name": "零食",
    "ParentID": "",
    "Level": 1,
    "CreateAt": 1492161558,
    "UpdatedAt": 1492161558,
    "id": "58f094160f5dbd1100568db3"
  },
  "StockVO": {
    "Qty": 66,
    "AvgPrice": 505
  },
  "AccountStock": 0
}

function appendGoods(goods) {
  const cateId = goods.CategoryVO.ParentID;
  const groupId = goods.CategoryVO.id;
  // level 1
  // const cateIdx = data[0].children.findIndex(i => i.id === cateId);
  // let targetCate;
  // if (cateIdx === -1) {
  //   const newCate = {
  //     id: cateId,
  //     text: goods.ParentCategoryVO.Name,
  //     level: 1,
  //     'parent_id': '',
  //     children: [],
  //   };
  //   const newCateIdx = data[0].children.push(newCate) - 1;
  //   targetCate = data[0].children[newCateIdx];
  // } else {
  //   targetCate = data[0].children[cateIdx];
  // }
  const targetCate = _checkCate(cateId, data, goods);
  // level 2
  const targetGroup = _ckeckGroup(groupId, cateId, targetCate, goods);
  // const groupIdx = targetCate.children.findIndex(i => i.id === groupId);
  // let targetGroup;
  // if (groupIdx === -1) {
  //   const newGroup = {
  //     id: groupId,
  //     text: goods.CategoryVO.Name,
  //     level: 2,
  //     parent_id: cateId,
  //     children: [],
  //   };
  //   const newGroupIdx = targetCate.children.push(newGroup) - 1;
  //   targetGroup = targetCate.children[newGroupIdx];
  // } else {
  //   targetGroup = targetCate[groupIdx];
  // }
  // level 3
  const itemId = targetGroup.children.findIndex(i => i.BarCode === goods.BarCode);
  if (itemId === -1) {
    targetGroup.children.push(goods)
  } else {
    console.log('that goods is in')
  }
}

function _checkCate(cateId, data, goods) {
  const cateIdx = data[0].children.findIndex(i => i.id === cateId);
  if (cateIdx === -1) {
    const newCate = {
      id: cateId,
      text: goods.ParentCategoryVO.Name,
      level: 1,
      'parent_id': '',
      children: [],
    };
    const newCateIdx = data[0].children.push(newCate) - 1;
    return data[0].children[newCateIdx];
  } else {
    return data[0].children[cateIdx];
  }
}

function _ckeckGroup(groupId, cateId, targetCate, goods) {
  const groupIdx = targetCate.children.findIndex(i => i.id === groupId);
  if (groupIdx === -1) {
    const newGroup = {
      id: groupId,
      text: goods.CategoryVO.Name,
      level: 2,
      parent_id: cateId,
      children: [],
    };
    const newGroupIdx = targetCate.children.push(newGroup) - 1;
    return targetCate.children[newGroupIdx];
  } else {
    return targetCate[groupIdx];
  }
}

appendGoods(new3)
// appendGoods(new1)
// appendGoods(new2)

console.log(
  JSON.stringify(data, null, 2)
)

/*
    _addPickupSpecies(goods) {
      const simpleGood = {
        AccountStock: goods.AccountStock || 0, // 改了字段
        BarCode: goods.BarCode,
        BoxGauge: goods.ProductVO.BoxGauge || 1,
        CategoryID: goods.CategoryID,
        ImageFixWidthUrl: goods.ProductVO.ImageFixWidthUrl,
        ImageUrl: goods.ProductVO.ImageUrl,
        Name: goods.ProductVO.Name,
        ParentCategoryID: goods.ParentCategoryID,
        TotalReplenishStock: 0,
        TotalSalesCount: 0,
        pickupNum: 0,
        stockoutCount: 0,
        id: goods.id,
        name: goods.ProductVO.Name,
      };

      const simpleCategory = {
        Level: 2,
        children: [simpleGood],
        count: goods.ReplenisherStock.Stock,
        display: true,
        id: goods.CategoryVO.id,
        items: [simpleGood],
        name: goods.CategoryVO.Name,
        text: goods.CategoryVO.Name,
        ParentCategoryVO: goods.ParentCategoryVO,
      };

      const alreadyInLeft = this.leftArray.find(cate => {
        return cate.id === goods.ParentCategoryID;
      });
      if (!alreadyInLeft) {
        this.leftArray.push({
          id: goods.ParentCategoryID,
          name: goods.ParentCategoryVO.Name,
          groups: [],
        });
      }

      // 是否有这个分组
      const some = this.mainArray.groups.some(
        cat => cat.id === goods.CategoryID,
      );

      if (some) {
        this.mainArray.groups.forEach(cat => {
          if (cat.id === goods.CategoryID) {
            const ProductsSome = cat.children.some(
              Product => Product.BarCode === goods.BarCode,
            );
            if (!ProductsSome) cat.items.push(simpleGood);
          }
        });
      } else {
        this.mainArray.groups.push(simpleCategory);
      }
    },
*/
